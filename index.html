<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Dinero de jugadores</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #f5f5f5;
      padding: 20px;
    }
    h1 {
      margin-bottom: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 12px;
      border-bottom: 1px solid #333;
      text-align: left;
    }
    th {
      background: #222;
    }
    tr:hover {
      background: #1a1a1a;
    }
    button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      background: #222;
      color: #f5f5f5;
      border: none;
      border-radius: 5px;
      margin-right: 10px;
    }
    button:hover {
      background: #333;
    }
    input, select {
      padding: 6px;
      font-size: 16px;
      margin-right: 10px;
      border-radius: 5px;
      border: none;
    }
    #clock {
      font-size: 20px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>ðŸ’° Dinero de jugadores (actualizado cada 24h)</h1>
  <div id="clock">âŒš Cargando hora...</div>

  <table>
    <thead>
      <tr>
        <th>Jugador</th>
        <th>Dinero</th>
        <th>Ingreso diario</th>
        <th>Gasto diario</th>
      </tr>
    </thead>
    <tbody id="players"></tbody>
  </table>

  <button id="resetBtn">ðŸ”„ Reiniciar valores</button>
  <br><br>
  <input type="number" id="customAmount" placeholder="Cantidad a restar/sumar en B" />
  <select id="selectPlayer">
    <option value="Jon">Jon</option>
    <option value="Noah">Noah</option>
    <option value="Cesc">Cesc</option>
    <option value="Ignasi">Ignasi</option>
    <option value="Unai N.">Unai N.</option>
    <option value="Dylan">Dylan</option>
    <option value="Alex">Alex</option>
    <option value="Extra">Extra</option>
  </select>
  <button id="addMoneyBtn">âž• Agregar dinero</button>
  <button id="subtractMoneyBtn">âž– Restar dinero</button>
  <br><br>
  <input type="number" id="dailyIncomeInput" placeholder="Nuevo ingreso diario" />
  <input type="number" id="dailyExpenseInput" placeholder="Nuevo gasto diario" />
  <button id="updateDailyBtn">ðŸ’¼ Actualizar ingreso/gasto diario</button>

  <script>
    const initialPlayers = [
      { name: "Jon", country: "Alemania", money: 2.0, dailyIncome: 4.6, dailyExpense: 2.3 },
      { name: "Noah", country: "EspaÃ±a", money: 5.0, dailyIncome: 1.6, dailyExpense: 0 },
      { name: "Cesc", country: "Italia", money: 0, dailyIncome: 1.2, dailyExpense: 0 },
      { name: "Ignasi", country: "Reino Unido", money: 2.5, dailyIncome: 4.0, dailyExpense: 4.0 },
      { name: "Unai N.", country: "Francia", money: 4.0, dailyIncome: 2.9, dailyExpense: 2.9 },
      { name: "Dylan", country: "Rusia", money: 4.0, dailyIncome: 2.9, dailyExpense: 2.9 },
      { name: "Alex", country: "Suiza", money: 0, dailyIncome: 0.7, dailyExpense: 0 },
      { name: "Extra", country: "PaÃ­s X", money: 0, dailyIncome: 1.0, dailyExpense: 0 }
    ];

    const players = initialPlayers.map(p => ({ ...p }));

    let lastUpdate = localStorage.getItem('lastUpdate');
    if(!lastUpdate) lastUpdate = Date.now();
    lastUpdate = parseInt(lastUpdate);

    players.forEach(p => {
      const saved = localStorage.getItem(p.name);
      if (saved) p.money = parseFloat(saved);
    });

    function updateMoneySinceLast() {
      const now = Date.now();
      const daysPassed = Math.floor((now - lastUpdate) / 86400000);
      if(daysPassed > 0){
        players.forEach(p => {
          p.money += (p.dailyIncome - p.dailyExpense) * daysPassed;
          if(p.money < 0) p.money = 0;
        });
        lastUpdate = now;
        localStorage.setItem('lastUpdate', lastUpdate);
        saveMoney();
      }
    }

    function render() {
      const tbody = document.getElementById("players");
      tbody.innerHTML = "";
      players.forEach(p => {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${p.name} (${p.country})</td><td>â‚¬${p.money.toFixed(2)}B</td><td>â‚¬${p.dailyIncome.toFixed(2)}B</td><td>â‚¬${p.dailyExpense.toFixed(2)}B</td>`;
        tbody.appendChild(row);
      });
    }

    function saveMoney() {
      players.forEach(p => {
        localStorage.setItem(p.name, p.money);
      });
    }

    function resetValues() {
      players.forEach((p, index) => {
        p.money = initialPlayers[index].money;
        p.dailyIncome = initialPlayers[index].dailyIncome;
        p.dailyExpense = initialPlayers[index].dailyExpense;
      });
      lastUpdate = Date.now();
      localStorage.setItem('lastUpdate', lastUpdate);
      render();
      saveMoney();
    }

    function addMoneyToPlayer(amount, playerName) {
      const player = players.find(p => p.name === playerName);
      if(player) player.money += amount;
      render();
      saveMoney();
    }

    function subtractMoneyFromPlayer(amount, playerName) {
      const player = players.find(p => p.name === playerName);
      if(player) {
        player.money -= amount;
        if(player.money < 0) player.money = 0;
      }
      render();
      saveMoney();
    }

    function updateDailyValues() {
      const playerName = document.getElementById("selectPlayer").value;
      const income = parseFloat(document.getElementById("dailyIncomeInput").value);
      const expense = parseFloat(document.getElementById("dailyExpenseInput").value);
      const player = players.find(p => p.name === playerName);
      if(player) {
        if(!isNaN(income)) player.dailyIncome = income;
        if(!isNaN(expense)) player.dailyExpense = expense;
        render();
      }
    }

    function updateClock() {
      const now = new Date().toLocaleString('es-ES', { timeZone: 'Europe/Madrid', hour12: false });
      document.getElementById('clock').textContent = 'âŒš Hora en Barcelona: ' + now;
      // Si son las 00:00, sumar ingresos/gastos
      const date = new Date(new Date().toLocaleString('en-US', { timeZone: 'Europe/Madrid' }));
      if(date.getHours() === 0 && date.getMinutes() === 0 && date.getSeconds() === 0){
        players.forEach(p => {
          p.money += (p.dailyIncome - p.dailyExpense);
          if(p.money < 0) p.money = 0;
        });
        lastUpdate = Date.now();
        localStorage.setItem('lastUpdate', lastUpdate);
        render();
        saveMoney();
      }
    }

    document.getElementById("resetBtn").addEventListener("click", resetValues);
    document.getElementById("addMoneyBtn").addEventListener("click", () => {
      const amount = parseFloat(document.getElementById("customAmount").value);
      const playerName = document.getElementById("selectPlayer").value;
      if(!isNaN(amount)) addMoneyToPlayer(amount, playerName);
    });
    document.getElementById("subtractMoneyBtn").addEventListener("click", () => {
      const amount = parseFloat(document.getElementById("customAmount").value);
      const playerName = document.getElementById("selectPlayer").value;
      if(!isNaN(amount)) subtractMoneyFromPlayer(amount, playerName);
    });
    document.getElementById("updateDailyBtn").addEventListener("click", updateDailyValues);

    updateMoneySinceLast();
    render();
    setInterval(updateClock, 1000);
  </script>
</body>
</html>